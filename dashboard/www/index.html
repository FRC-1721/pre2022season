<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
</head>

<body>

    <!-- This starts the NetworkTables websocket, it can be accessed from multiple
     pages simultaneously -->
    <script src="/networktables/networktables.js"></script>

    <!-- Obviously, you will want to copy this file locally in a real 
     dashboard, as the Driver Station won't have internet access -->
    <script src="https://code.jquery.com/jquery-2.2.2.min.js"></script>

    <!-- uncomment this is you want to use included utility functions that
     implement common functionality that you might find useful. Requires
     that d3.js and jQuery are included first -->
    <!-- <script src="/networktables/utils.js"></script> -->

    <div>
        NetworkTables websocket: <span id="connectstate">Unknown state</span><br />
        Robot: <span id="robotstate">Unknown state</span> @ <span id="robotAddress">disconnected</span>
    </div>
    <hr />

    <canvas id="SwerveCanvas" width="1000" height="400"></canvas>


    <script type="text/javascript">
        "use strict";

        $(document).ready(function () {

            // sets a function that will be called when the websocket connects/disconnects
            NetworkTables.addWsConnectionListener(onNetworkTablesConnection, true);

            // sets a function that will be called when the robot connects/disconnects
            NetworkTables.addRobotConnectionListener(onRobotConnection, true);

            NetworkTables.addKeyListener('/SmartDashboard/SwerveDrive/fp_actual', swerveListener, true);
            console.log("Started")
        });

        function swerveListener(key, value, isNew) {
            console.log(value)

            var canvas = document.getElementById('SwerveCanvas');
            if (canvas.getContext) {
                var ctx = canvas.getContext('2d');

                ctx.clearRect(0, 0, canvas.width, canvas.height);

                ctx.fillRect(25, 25, 100, 100);
                ctx.rotate(value)
            }
        }

        function onRobotConnection(connected) {
            $('#robotstate').text(connected ? "Connected!" : "Disconnected");
            $('#robotAddress').text(connected ? NetworkTables.getRobotAddress() : "disconnected");
        }

        function onNetworkTablesConnection(connected) {

            if (connected) {
                $("#connectstate").text("Connected!");

                // clear the table
                $("#nt tbody > tr").remove();

                console.log(NetworkTables.getKeys())

            } else {
                $("#connectstate").text("Disconnected!");
            }
        }

    </script>

</body>

</html>